{
  "entities": {
    "Client": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Client",
      "type": "object",
      "description": "Represents a client who takes loans.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Client entity."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the client."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the client."
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number of the client."
        },
        "address": {
          "type": "string",
          "description": "Address of the client."
        },
        "isNewClient": {
          "type": "boolean",
          "description": "Indicates whether the client is new or returning."
        },
        "status": {
          "type": "string",
          "description": "Status of the client (e.g., good, overdue, skipping payments).",
          "enum": ["good", "default", "overdue", "delinquent"]
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "phoneNumber",
        "address",
        "isNewClient",
        "status"
      ]
    },
    "Loan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Loan",
      "type": "object",
      "description": "Represents a loan issued to a client.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Loan entity."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client. (Relationship: Client 1:N Loan)"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the loan issued."
        },
        "interestRate": {
          "type": "number",
          "description": "Interest rate applied to the loan (e.g., 0.20 for 20%)."
        },
        "processingFeeRate": {
          "type": "number",
          "description": "Processing fee rate applied to the loan (e.g., 0.04 for 4%)."
        },
        "issueDate": {
          "type": "string",
          "description": "Date when the loan was issued.",
          "format": "date-time"
        },
        "dueDate": {
          "type": "string",
          "description": "Date when the loan is due.",
          "format": "date-time"
        },
        "totalRepayable": {
          "type": "number",
          "description": "Total amount repayable (principal + interest + fees)."
        },
        "status": {
            "type": "string",
            "description": "The status of the loan.",
            "enum": ["active", "paid", "overdue"]
        }
      },
      "required": [
        "id",
        "clientId",
        "amount",
        "interestRate",
        "processingFeeRate",
        "issueDate",
        "dueDate",
        "totalRepayable",
        "status"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment made by a client towards a loan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payment entity."
        },
        "loanId": {
          "type": "string",
          "description": "Reference to Loan. (Relationship: Loan 1:N Payment)"
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client. (Relationship: Client 1:1 Payment)"
        },
        "paymentDate": {
          "type": "string",
          "description": "Date when the payment was made.",
          "format": "date-time"
        },
        "amountPaid": {
          "type": "number",
          "description": "Amount paid by the client."
        }
      },
      "required": [
        "id",
        "loanId",
        "clientId",
        "paymentDate",
        "amountPaid"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an operational expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Expense entity."
        },
        "category": {
          "type": "string",
          "description": "Category of the expense.",
          "enum": ["lunch", "transport", "airtime", "other"]
        },
        "description": {
          "type": "string",
          "description": "Description of the expense."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the expense."
        },
        "date": {
          "type": "string",
          "description": "Date of the expense.",
          "format": "date-time"
        }
      },
      "required": ["id", "category", "description", "amount", "date"]
    },
    "CashFlow": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CashFlow",
      "type": "object",
      "description": "Represents cash flow transactions (in and out).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CashFlow entity."
        },
        "transactionDate": {
          "type": "string",
          "description": "Date of the cash flow transaction.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the cash flow transaction (e.g., lunch, transport, airtime, loan issued, repayment)."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the cash flow transaction.  Positive for cash in, negative for cash out."
        },
        "type": {
          "type": "string",
          "description": "Type of the cashflow transaction (e.g., 'cashIn', 'cashOut', 'expense')."
        }
      },
      "required": [
        "id",
        "transactionDate",
        "description",
        "amount",
        "type"
      ]
    },
    "CashierPerformance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CashierPerformance",
      "type": "object",
      "description": "Represents the performance data of a cashier.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CashierPerformance entity."
        },
        "cashierId": {
          "type": "string",
          "description": "Reference to the User entity representing the cashier."
        },
        "transactionDate": {
          "type": "string",
          "description": "Date of the transaction.",
          "format": "date-time"
        },
        "transactionType": {
          "type": "string",
          "description": "Type of transaction (e.g., loan issuance, repayment)."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction."
        },
        "notes": {
          "type": "string",
          "description": "Notes generated by the LLM analysis, indicating deviations from average or suspicious patterns."
        }
      },
      "required": [
        "id",
        "cashierId",
        "transactionDate",
        "transactionType",
        "amount"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the system (e.g., cashier, manager).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., cashier, admin).",
          "enum": ["cashier", "admin"]
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "role"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": {
            "$ref": "#/backend/entities/Client"
          },
          "description": "Stores client information. Each client document is uniquely identified by clientId."
        }
      },
      {
        "path": "/loans/{loanId}",
        "definition": {
          "entityName": "Loan",
          "schema": {
            "$ref": "#/backend/entities/Loan"
          },
          "description": "Stores loan information for a specific client."
        }
      },
      {
        "path": "/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Stores payment information for a specific loan of a specific client."
        }
      },
      {
        "path": "/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores all operational expenses."
        }
      },
      {
        "path": "/cash_flow/{cashFlowId}",
        "definition": {
          "entityName": "CashFlow",
          "schema": {
            "$ref": "#/backend/entities/CashFlow"
          },
          "description": "Stores cash flow transactions."
        }
      },
      {
        "path": "/cashier_performance/{cashierPerformanceId}",
        "definition": {
          "entityName": "CashierPerformance",
          "schema": {
            "$ref": "#/backend/entities/CashierPerformance"
          },
          "description": "Stores cashier performance data."
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user information."
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Documents in this collection represent admin users. Existence of a document indicates admin role."
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure and scalable. It uses role-based access control where 'admins' have broad permissions and 'cashiers' have limited permissions. Admins are identified by checking for their UID in the '/roles_admin' collection, a secure method that prevents users from elevating their own privileges. Cashier access is restricted to managing clients, loans, and payments, which aligns with their responsibilities. The performance and cash flow data are restricted to admins to protect sensitive business information. This separation of concerns in the data model and security rules ensures a robust and secure application."
  }
}
